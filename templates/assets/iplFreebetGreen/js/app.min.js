class BetGame {
  constructor() {
    ((this.spinButton = document.getElementById('go-btn')),
      (this.winButton = document.getElementById('win-button-modal')),
      (this.content = document.getElementById('content')),
      (this.modal = document.getElementById('modal')));
  }
  initGame() {
    (this.calculateFontSize(this.spinButton),
      window.addEventListener('placementOpenModal', () => {
        this.showModal();
      }),
      this.spinButton.addEventListener('click', () => {
        this.initSpin();
      }));
  }
  initSpin() {
    window.isMobile && window.pushPlacement && !window.firstClick
      ? window.dispatchEvent(
          new CustomEvent('placementFirstClick', {
            detail: [this.spin.bind(this)]
          })
        )
      : this.spin();
  }
  spin() {
    this.triggerShowModal();
  }
  showModal() {
    (document.body.classList.add('is--modal-open'),
      this.modal.classList.add('is--active'),
      this.calculateFontSize(this.winButton));
  }
  triggerShowModal(t = 0) {
    setTimeout(() => {
      window.dispatchEvent(new Event('placementOpenModal'));
    }, t);
  }
  calculateFontSize(
    t,
    e = {
      threshold: 15,
      step: 0.02,
      minPercent: 0.6
    }
  ) {
    if (!t) return;
    const n = t.querySelectorAll('span');
    n &&
      n.forEach((t) => {
        const n = String(t.innerText).length,
          i = window.getComputedStyle(t),
          o = parseFloat(i.getPropertyValue('font-size')),
          s = o,
          d = o * e.minPercent,
          a = Math.max(0, n - e.threshold),
          l = Math.max(s - a * (o * e.step), d);
        t.style.fontSize = `${l}px`;
      });
  }
}
document.addEventListener('DOMContentLoaded', () => {
  new BetGame().initGame();
});
